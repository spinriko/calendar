@page
@model pto.track.Pages.AbsencesSchedulerModel
@{
    ViewData["Title"] = "Absence Scheduler View";
}

<script src="~/lib/daypilot/daypilot-all.min.js" asp-append-version="true"></script>

<style>
    .disabled-row {
        background-color: #eeeeee !important;
        cursor: not-allowed !important;
        pointer-events: none;
    }
</style>

<div class="left">
    <div id="datepicker"></div>
</div>
<div class="right">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 15px;">
        <div class="buttons">
            <button id="previous">Previous</button>
            <button id="today">Today</button>
            <button id="next">Next</button>
        </div>
        <div class="view-switcher" style="display: flex; gap: 5px;">
            <button id="viewDay" class="view-btn" style="padding: 5px 10px; cursor: pointer;">Day</button>
            <button id="viewWeek" class="view-btn"
                style="padding: 5px 10px; cursor: pointer; font-weight: bold; background-color: #ddd;">Week</button>
            <button id="viewMonth" class="view-btn" style="padding: 5px 10px; cursor: pointer;">Month</button>
        </div>
        <div id="statusFilters"
            style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: #f5f5f5; border-radius: 4px;">
            <span style="font-weight: 600; margin-right: 5px;">Show:</span>
            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="filterPending" value="Pending" checked
                    style="width: 16px; height: 16px; accent-color: #ffa500;">
                <span>Pending</span>
            </label>
            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="filterApproved" value="Approved" checked
                    style="width: 16px; height: 16px; accent-color: #6aa84f;">
                <span>Approved</span>
            </label>
            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="filterRejected" value="Rejected" checked
                    style="width: 16px; height: 16px; accent-color: #cc4125;">
                <span>Rejected</span>
            </label>
            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 13px;">
                <input type="checkbox" id="filterCancelled" value="Cancelled" checked
                    style="width: 16px; height: 16px; accent-color: #999999;">
                <span>Cancelled</span>
            </label>
        </div>
    </div>
    <div id="scheduler"></div>
</div>

<!-- Create/Edit Absence Modal -->
<div class="modal fade" id="absenceModal" tabindex="-1" aria-labelledby="absenceModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="absenceModalLabel">Create Absence</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="absenceForm">
                    <input type="hidden" id="absenceResourceId" />

                    <!-- Date Selection -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="absenceStart" class="form-label fw-bold">Start Date</label>
                            <input type="date" class="form-control" id="absenceStart" required>
                        </div>
                        <div class="col-md-6">
                            <label for="absenceEnd" class="form-label fw-bold">End Date</label>
                            <input type="date" class="form-control" id="absenceEnd" required>
                        </div>
                    </div>

                    <!-- All Day Toggle -->
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="absenceAllDay" checked>
                        <label class="form-check-label fw-bold" for="absenceAllDay">All Day</label>
                    </div>

                    <!-- Time Selection (Hidden by default) -->
                    <div id="timeSelectionRow" class="row mb-3" style="display: none;">
                        <div class="col-md-6">
                            <label for="absenceStartTime" class="form-label fw-bold">Start Time</label>
                            <input type="time" class="form-control" id="absenceStartTime" value="08:00" step="900">
                        </div>
                        <div class="col-md-6">
                            <label for="absenceEndTime" class="form-label fw-bold">End Time</label>
                            <input type="time" class="form-control" id="absenceEndTime" value="17:00" step="900">
                        </div>
                    </div>

                    <!-- Duration Display -->
                    <div class="alert alert-info py-2 mb-3" id="durationDisplay">
                        Total: <span id="durationValue">1 Day</span>
                    </div>

                    <!-- Reason -->
                    <div class="mb-3">
                        <label for="absenceReason" class="form-label fw-bold">Reason</label>
                        <textarea class="form-control" id="absenceReason" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveAbsenceBtn">Save</button>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { AbsenceSchedulerApp } from '/js/absences-scheduler.js';

    // Ensure DayPilot is loaded
    if (typeof DayPilot !== 'undefined') {
        const app = new AbsenceSchedulerApp(DayPilot, "scheduler", "datepicker");
        app.init();
    } else {
        console.error("DayPilot library not loaded.");
    }
</script>